{% extends "app/dashboard/base.html" %} {% block title %}dash | home{% endblock title %}
{% block content %}
<main>
  <!-- Start of Documentation -->
  <div class="bloc-doc-container p-2 container-fluid">
    <!-- Docs Header -->
    <center>
      <div class ="container pt-5">
        <h1> Get started with Sign up</h1>
        <p class="lead fw-normal text-muted mb-5 mb-lg-0">bloc is a simple authentication toolkit. Build anything from prototype to production in minutes.</p>
      </div>
    </center>
		<br>
    <!-- end Docs header -->
    <!--Signup Docs-->
    <div class="container">
      <div>
        <h2>Step 1: JavaScript</h2>
        <img src="/static/app/images/finished-image.png" class="img-fluid p-3" alt="Goal">
        <center>
          <p class="lead fw-normal text-muted mb-5 mb-lg-0">
            Step 1 enables interaction between device and your application
          </p>
        </center>
      </div>
      <div>
        <br>
        <p class="lead fw-normal text-muted mb-5 mb-lg-0">
          First copy the code below to enable interaction between your application and your users device.
        </p>
        <div class="bloc-code-box">
          <pre><code class="language-javascript" data-prismjs-copy="Copy">!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).blocJS={})}(this,(function(e){"use strict";var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&amp;&amp;(e[n]=t[n])},t(e,n)};var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n&lt;r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&amp;&amp;(e[o]=t[o]);return e},n.apply(this,arguments)};function r(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function o(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&amp;&amp;o[o.length-1])||6!==i[0]&amp;&amp;2!==i[0])){a=0;continue}if(3===i[0]&amp;&amp;(!o||i[1]>o[0]&amp;&amp;i[1]&lt;o[3])){a.label=i[1];break}if(6===i[0]&amp;&amp;a.label&lt;o[1]){a.label=o[1],o=i;break}if(o&amp;&amp;a.label&lt;o[2]){a.label=o[2],a.ops.push(i);break}o[2]&amp;&amp;a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function i(e){var t,n,r=new Uint8Array(e),o="";try{for(var i=function(e){var t="function"==typeof Symbol&amp;&amp;Symbol.iterator,n=t&amp;&amp;e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&amp;&amp;e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(r),a=i.next();!a.done;a=i.next()){var s=a.value;o+=String.fromCharCode(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return btoa(o).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function a(e){for(var t=e.replace(/-/g,"+").replace(/_/g,"/"),n=(4-t.length%4)%4,r=t.padEnd(t.length+n,"="),o=atob(r),i=new ArrayBuffer(o.length),a=new Uint8Array(i),s=0;s&lt;o.length;s++)a[s]=o.charCodeAt(s);return i}function s(){return void 0!==(null===window||void 0===window?void 0:window.PublicKeyCredential)&&"function"==typeof window.PublicKeyCredential}function u(e){var t=e.id;return n(n({},e),{id:a(t),transports:e.transports})}function c(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}var l=function(e){function n(t){var n=t.message,r=t.code,o=t.cause,i=t.name,a=e.call(this,n,{cause:o})||this;return a.name=null!=i?i:o.name,a.code=r,a}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(n,e),n}(Error);var d=new(function(){function e(){}return e.prototype.createNewAbortSignal=function(){if(this.controller){var e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}var t=new AbortController;return this.controller=t,t.signal},e}()),f=["cross-platform","platform"];function p(e){if(e&&!(f.indexOf(e)<0))return e}function h(){return r(this,void 0,void 0,(function(){var e;return o(this,(function(t){return[2,void 0!==(e=window.PublicKeyCredential).isConditionalMediationAvailable&&e.isConditionalMediationAvailable()]}))}))}e.browserSupportsWebAuthn=s,e.browserSupportsWebAuthnAutofill=h,e.platformAuthenticatorIsAvailable=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){return s()?[2,PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()]:[2,!1]}))}))},e.startLogin=function(e,t){var f,w;return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var r,R,b,E,y,v,g,m,A;return o(this,(function(o){switch(o.label){case 0:if(!s())throw new Error("WebAuthn is not supported in this browser");return 0!==(null===(f=e.allowCredentials)||void 0===f?void 0:f.length)&&(r=null===(w=e.allowCredentials)||void 0===w?void 0:w.map(u)),R=n(n({},e),{challenge:a(e.challenge),allowCredentials:r}),b={},t?[4,h()]:[3,2];case 1:if(!o.sent())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete*='webauthn']").length<1)throw Error('No &lt;input> with `"webauthn"` in its `autocomplete` attribute was detected');b.mediation="conditional",R.allowCredentials=[],o.label=2;case 2:b.publicKey=R,b.signal=d.createNewAbortSignal(),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,navigator.credentials.get(b)];case 4:return E=o.sent(),[3,6];case 5:throw function(e){var t=e.error,n=e.options,r=n.publicKey;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(n.signal instanceof AbortSignal)return new l({message:"Login ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if("NotAllowedError"===t.name)return new l({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if("SecurityError"===t.name){var o=window.location.hostname;if(!c(o))return new l({message:"".concat(window.location.hostname," is an invalid domain"),code:"ERROR_INVALID_DOMAIN",cause:t});if(r.rpId!==o)return new l({message:'The RP ID "'.concat(r.rpId,'" is invalid for this domain'),code:"ERROR_INVALID_RP_ID",cause:t})}else if("UnknownError"===t.name)return new l({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return t}({error:o.sent(),options:b});case 6:if(!E)throw new Error("Login was not completed");return y=E.id,v=E.rawId,g=E.response,m=E.type,A=void 0,g.userHandle&&(_=g.userHandle,A=new TextDecoder("utf-8").decode(_)),[2,{id:y,rawId:i(v),response:{authenticatorData:i(g.authenticatorData),clientDataJSON:i(g.clientDataJSON),signature:i(g.signature),userHandle:A},type:m,clientExtensionResults:E.getClientExtensionResults(),authenticatorAttachment:p(E.authenticatorAttachment)}]}var _}))}))},e.startSignup=function(e){var t;return r(this,void 0,void 0,(function(){var r,f,h,w,R,b,E,y;return o(this,(function(o){switch(o.label){case 0:if(!s())throw new Error("WebAuthn is not supported in this browser");r=n(n({},e),{challenge:a(e.challenge),user:n(n({},e.user),{id:(v=e.user.id,(new TextEncoder).encode(v))}),excludeCredentials:null===(t=e.excludeCredentials)||void 0===t?void 0:t.map(u)}),(f={publicKey:r}).signal=d.createNewAbortSignal(),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,navigator.credentials.create(f)];case 2:return h=o.sent(),[3,4];case 3:throw function(e){var t,n,r=e.error,o=e.options,i=o.publicKey;if(!i)throw Error("options was missing required publicKey property");if("AbortError"===r.name){if(o.signal instanceof AbortSignal)return new l({message:"Signup ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if("ConstraintError"===r.name){if(!0===(null===(t=i.authenticatorSelection)||void 0===t?void 0:t.requireResidentKey))return new l({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if("required"===(null===(n=i.authenticatorSelection)||void 0===n?void 0:n.userVerification))return new l({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if("InvalidStateError"===r.name)return new l({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if("NotAllowedError"===r.name)return new l({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if("NotSupportedError"===r.name)return 0===i.pubKeyCredParams.filter((function(e){return"public-key"===e.type})).length?new l({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new l({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if("SecurityError"===r.name){var a=window.location.hostname;if(!c(a))return new l({message:"".concat(window.location.hostname," is an invalid domain"),code:"ERROR_INVALID_DOMAIN",cause:r});if(i.rp.id!==a)return new l({message:'The RP ID "'.concat(i.rp.id,'" is invalid for this domain'),code:"ERROR_INVALID_RP_ID",cause:r})}else if("TypeError"===r.name){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new l({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if("UnknownError"===r.name)return new l({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return r}({error:o.sent(),options:f});case 4:if(!h)throw new Error("Signup was not completed");return w=h.id,R=h.rawId,b=h.response,E=h.type,y=void 0,"function"==typeof b.getTransports&&(y=b.getTransports()),[2,{id:w,rawId:i(R),response:{attestationObject:i(b.attestationObject),clientDataJSON:i(b.clientDataJSON),transports:y},type:E,clientExtensionResults:h.getClientExtensionResults(),authenticatorAttachment:p(h.authenticatorAttachment)}]}var v}))}))},Object.defineProperty(e,"__esModule",{value:!0})}));</code></pre>
        </div>
        <!-- end blocJS enabler -->
				<!-- Start enable Send and Recieve webauthn data -->
				<br>
				<p class="lead fw-normal text-muted mb-5 mb-lg-0">
					Next copy the code below to send and recieve data to and from our api. You will need to edit 8 parts, which you can easily find by ctrl + f (windows) or command + f (mac) and enter 'EDIT' to search for all 8. This will be referred to as 'auth-script' throughout the docs.
				</p>
				<div class="bloc-code-box">
					<pre><code class="language-javascript">// import blocJS auth methods
const { startSignup, startLogin } = blocJS;
/**
 * Signup Button
 */
document
	// 1. EDIT your Signup button html 'id' below
  .getElementById("yourSignupBtnIDHere")
  .addEventListener("click", async () => {
    /* Generate signup options for your user */
		// 2. EDIT this fetch request your route that will make the api request to our server
    const resp = await fetch("/your-signup-route-here");
    const opts = await resp.json();
    // Start WebAuthn Registration
    let regResp;
    try {
      regResp = await startSignup(opts);
			// if more than one transport pop one (only one is needed)
			if (regResp.transports) {
				if (regResp.transports.length == 2) {
					regResp.transports.pop(1);
				}
			}
    } catch (err) {
			if (err == undefined || typeof(err) == 'undefined') {
    		console.log("err is undefined");
			}
      throw new Error(err);
    }
    /* Send response to server */
		// 3. EDIT this fetch request your route that will make the api request to our server
    const verificationResp = await fetch(
      "/your-verify-signup-route-here",
      {
        method: "POST",
				mode: 'cors',
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(regResp),
      }
    );
    // Report validation response
    const verificationRespJSON = await verificationResp.json();
    const { verified, msg } = verificationRespJSON;
    if (verified) {
			/* Redirect to your "login required" page */
			// 4. EDIT this location to redirect the user to your login required page
			window.location = "/your/redirect/location/here";
    } else {
			console.log("not authenticated");
    }
});


/**
 * Login Button
 */
document
	// 5. EDIT your Login button html 'id' below
  .getElementById("yourLoginBtnIDHere")
  .addEventListener("click", async () => {
    /* Generate login options for your user */
		// 6. EDIT this fetch request your route that will make the api request to our server
    const resp = await fetch("/your-login-route-here");
    const opts = await resp.json();
    // Start bloc Login
    let authResp;
    try {
    authResp = await startLogin(opts);
    } catch (err) {
      throw new Error(err);
    }
    /* Send response to server */
		// 7. EDIT this fetch request your route that will make the api request to our server
    const verificationResp = await fetch(
      "/your-verify-login-route-here",
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(authResp),
      }
    );
    // Report validation response
    const verificationRespJSON = await verificationResp.json();
    const { verified, msg } = verificationRespJSON;
		if (verified) {
			/* Redirect to your "login required" page */
			// 8. EDIT this location to redirect the user to your login required page
			window.location = "/your/redirect/location/here";
    } else {
			console.log("not authenticated");
    }
});</code></pre>
					<p class="lead fw-normal text-muted mb-5 mb-lg-0">
						Now we will take a look at the server side to build the authentication flow.
					</p>
				</div>
        <!-- end Send and Recieve enabler -->
				<!-- Start Server Side -->
				<br>
				<div>
	        <h2>Step 2: Server side</h2>
	        <img src="/static/app/images/finished-image.png" class="img-fluid p-3" alt="Goal">
	        <center>
	          <p class="lead fw-normal text-muted mb-5 mb-lg-0">
	            Step 2 enables complete authentication between device and your application
	          </p>
	        </center>
	      </div>
				<br>
        <p class="lead fw-normal text-muted mb-5 mb-lg-0">
          Note: Python's Flask web framework will be used for easy reading. It is already installed so those steps have been skipped. Flask's login manager is being used for easy session handling. If you have built sessions yourself, that's ok, continue through and you will see where your equivalent will be.
					<br>
					Also, all of the code below is within ONE file. You can set environment variables if you'd like but for simplicity, all the code below is within ONE file.
					<br>
					If you are using Flask (good taste btw 🤓), then import the following because you will use them later.
				</p>
					<div class="bloc-code-box">
	          <pre><code class="language-python" data-prismjs-copy="Copy">from flask import session, url_for, request, redirect
import	json
import requests
import base64</code></pre>
				</div>
				<br>
				<h3>Settings</h3>
				<p class="lead fw-normal text-muted mb-5 mb-lg-0">
					First you will need to configure some settings that are crucial to a secure authentication system. The code below demonstrates exactly what you would need in Python.
        </p>
        <div class="bloc-code-box">
          <pre><code class="language-python" data-prismjs-copy="Copy">#	your	domain
rp_id	=	"yourdomain.com"
#	your origin	site (basically just adding https:// if you don't use a sub-domain)
origin	=	"https://yourdomain.com"
# your site name
rp_name	=	"your domain name"

#	A	simple	way	to	persist	challenges	until	response	verification (extra layer of security that is required to use the api)
current_registration_challenge	=	None
current_authentication_challenge	=	None</code></pre>
				</div>
				<br>
				<h3>Signup Flow</h3>
				<p class="lead fw-normal text-muted mb-5 mb-lg-0">
					Next, you will be setting up the signup flow. You will use routes in this order, recieving users email, proccesing users email, and sending that users email to the api to initiate and verify the signup authentication  (yes we know...very tedious, but for now that's what it will be to ensure success)
        </p>
				<br>
				<p class="lead fw-normal text-muted mb-5 mb-lg-0">
					The first route, recieving, is simply displaying a page with an input field like below. After you build this route, go into your 'auth-script' and do "1. EDIT".
        </p>
				<img src="/static/app/images/signup_email.jpg" class="img-fluid p-3" alt="Goal">
				<!-- building server email processing -->
				<p class="lead fw-normal text-muted mb-5 mb-lg-0">
					Now, build the proccesing route like below. This route is processing the email that will be submitted by your user. After you build this route, go into your 'auth-script' and do "2. EDIT". Be sure to include the leading / for the route you built.
        </p>
        <div class="bloc-code-box">
          <pre><code class="language-python" data-prismjs-copy="Copy"># incoming post request from recieving view
	if	request.method	==	"POST":
		# add email to your session
		session['users_email']	=	request.form.get("name_of_your_input_field_here")
		# redirect to user next route to send to api 
		return redirect(url_for('your.redirect_route_here'))</code></pre>
				</div>
				<!-- building signup generation -->
				<p class="lead fw-normal text-muted mb-5 mb-lg-0">
					This next part is both of the last parts. First, this route is sending the data to the api. Then building the next route that will be used to verify the signup (as you can see, security is heavily baked in).
					After you build this route, go into your 'auth-script' and do "3. EDIT".
        </p>
        <div class="bloc-code-box">
          <pre><code class="language-python" data-prismjs-copy="Copy"># payload
	payload = {
		"domain" : rp_id, 
		"domain_name" : rp_name,
		"email" : session["email"]
	}
	# recieve bloc api response
	response = requests.get(url="https://bloc-api.bloclabs.repl.co/users/signup", params=payload).json()
	# turn response into a python dictionary 
	response_object = json.loads(response)
	# set registration challenge
	current_registration_challenge = response_object["challenge"]
	# decode registration challenge to expected challenge (the 3 ='s at the end are EXTREMELY IMPORTANT and NEED TO BE ADDED IN)
	current_registration_challenge = base64.urlsafe_b64decode(f"{current_registration_challenge}===")
	# return response to bloc js package, this is returning to '2. EDIT' if you cntl + f or command + f
	return response</code></pre>
				</div>
				<!-- building signup generation -->
				<p class="lead fw-normal text-muted mb-5 mb-lg-0">
					2nd part and lastly, the next route is signup verification.
					After you build this route, go into your 'auth-script' and do "4. EDIT".
        </p>
        <div class="bloc-code-box">
          <pre><code class="language-python" data-prismjs-copy="Copy"># data from coming from blocJS, '3. EDIT'
body	=	request.get_data()
# your payload for the api
payload = {
	"request" : body,
	"domain" : rp_id,
	"origin" : origin,
	"user" : session["email"],
}
# recieve response from post request
response = requests.post(url="https://bloc-api.bloclabs.repl.co/users/verify_signup", params= payload).json()
# if user is verified
if response["verified"] == True:
	# creating a new user object from your database
	new_user	=	YourUserModel(email=session["email"])
	# add and commit your user to your database
	db.session.add(new_user)
	db.session.commit()
	# login your user to your application
	# those who manually built their sessions, login user at this part of your authentication flow
	login_user(new_user,	remember=True)
	# flask feature to show user that they successfully signed up
	flash('Account created!', category = 'success')
	# return this response to '3. EDIT'
	return response
# otherwise they won't be logged in
else:
	return {"verified":False}</code></pre>
				</div>
				<br>
				<center>
		      <div class ="container">
		        <h1> Congratulations!!</h1>
		        <p class="lead fw-normal text-muted mb-lg-0">Your signup is done, now it's time to build login. IT IS PRETTY MUCH EXACTLY LIKE THIS FLOW just much shorter. Hang in there a little longer, it's almost over</p>
						<br>
						<div class="button"><a class="btn startup-price-btn" href="{{ url_for('views.docs_login') }}">Next</a></div>
						<br>
		      </div>
		    </center>
				<!-- everything before the below div -->
      </div>
    </div>
  </div>
</main>
<!--===============================================================================================-->
<script src="static/vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
<script src="static/vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
<script src="static/vendor/bootstrap/js/popper.js"></script>
<script src="static/vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
<script src="static/vendor/select2/select2.min.js"></script>
<!--===============================================================================================-->
<script src="static/vendor/daterangepicker/moment.min.js"></script>
<script src="static/vendor/daterangepicker/daterangepicker.js"></script>
<!--===============================================================================================-->
<script src="static/vendor/countdowntime/countdowntime.js"></script>
<!--===============================================================================================-->
<script src="static/js/main.js"></script>
<!-- JS -->
<script src="static/app/js/setup.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
  crossorigin="anonymous"></script>
{% endblock content %}